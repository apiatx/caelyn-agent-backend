The X sentiment data key x_twitter_crypto is not explicitly handled in the crypto compressor — it's probably getting stripped or aggressively truncated. And on the HyperLiquid OI issue, the get_all_perps() method returns open_interest_usd per coin, but the compressor's perps_top_volume section doesn't include it.

Prompt for Backend Replit Agent:
## Three fixes for crypto prompt response

### FIX 1: Top Perps by Volume — show 5 coins and include OI data

In `data_compressor.py`, find the `perps_top_volume` compression. Currently it sorts by volume but doesn't include open_interest_usd. Update to:
```python
    # Top perps by volume — include OI data from top_by_open_interest
    hl_fa = hl_raw.get("funding_analysis", {}) if isinstance(hl_raw, dict) else {}
    
    # Build OI lookup from top_by_open_interest
    oi_lookup = {}
    for item in (hl_fa.get("top_by_open_interest") or []):
        coin = (item.get("coin") or "").upper()
        if coin:
            oi_lookup[coin] = item.get("open_interest_usd")
    
    # Sort top_by_open_interest by volume to get top perps by volume WITH OI
    all_oi_items = hl_fa.get("top_by_open_interest") or []
    sorted_by_volume = sorted(all_oi_items, key=lambda x: x.get("volume_24h_usd", 0), reverse=True)
    
    compressed["perps_top_volume"] = [
        {
            "coin": g.get("coin"),
            "price_change_24h": g.get("price_change_24h"),
            "funding_rate": g.get("funding_rate"),
            "volume_24h_usd": g.get("volume_24h_usd"),
            "open_interest_usd": g.get("open_interest_usd"),
        }
        for g in sorted_by_volume[:5]  # Changed from [:4] to [:5]
    ]
```

Also update `perps_top_oi` to include 5 items:
```python
    compressed["perps_top_oi"] = [
        {
            "coin": o.get("coin"),
            "open_interest_usd": o.get("open_interest_usd"),
            "funding_rate": o.get("funding_rate"),
            "price_change_24h": o.get("price_change_24h"),
            "volume_24h_usd": o.get("volume_24h_usd"),
        }
        for o in (hl_fa.get("top_by_open_interest") or [])[:5]  # Ensure 5 items
    ]
```

Also update the Claude crypto prompt to instruct it to include OI data and show 5 perps:
For perps_top_volume: include the top 5 coins by volume. ALWAYS include the open_interest_usd field for each — this data comes from HyperLiquid and is always available. Format OI as dollar amounts (e.g., "$8.1B" or "$245M"). Never show "-" for OI when the data is present.

### FIX 2: Momentum picks missing 7d/funding for smaller coins (OM, AXS)

The root cause: CoinGecko top_coins only includes the top ~50 coins by market cap. OM (#27 on CoinGecko but sometimes lower) and AXS (#100+) are NOT in CoinGecko's top 50, so they have no 7d data. But HyperLiquid has their 24h price change, funding rate, OI, and volume.

The fix: Build a UNIFIED coin data source that merges CoinGecko (for top coins with 7d/30d data) AND HyperLiquid (for ALL perp-listed coins with funding/OI/24h data). Claude should use HyperLiquid as the primary source for any perps-traded coin and only supplement with CoinGecko for 7d/30d.

In the crypto compressor, AFTER building top_coins from CoinGecko, add ALL HyperLiquid coins that aren't already in the list:
```python
    # Build set of symbols already covered by CoinGecko
    cg_symbols = {c["symbol"] for c in compressed["top_coins"]}
    
    # Add HyperLiquid-only coins (not in CoinGecko top list) with their data
    # These are coins like OM, AXS, HYPE that trade on perps but aren't in CG top 50
    hl_assets = hl_raw.get("funding_analysis", {}).get("top_by_open_interest", []) if isinstance(hl_raw, dict) else []
    hl_gainers = hl_raw.get("funding_analysis", {}).get("top_gainers", []) if isinstance(hl_raw, dict) else []
    hl_squeezes = hl_raw.get("funding_analysis", {}).get("squeeze_candidates", []) if isinstance(hl_raw, dict) else []
    
    # Combine all unique HL coins
    hl_all_coins = {}
    for source in [hl_assets, hl_gainers, hl_squeezes]:
        for item in (source or []):
            coin = (item.get("coin") or "").upper()
            if coin and coin not in hl_all_coins:
                hl_all_coins[coin] = item
    
    # Add HL coins not in CoinGecko to a separate list for Claude
    compressed["hl_additional_coins"] = []
    for coin, item in hl_all_coins.items():
        if coin not in cg_symbols:
            compressed["hl_additional_coins"].append({
                "symbol": coin,
                "source": "hyperliquid",
                "price_change_24h": item.get("price_change_24h") or item.get("price_change_24h_pct"),
                "funding_rate": item.get("funding_rate"),
                "funding_annualized": item.get("funding_annualized") or item.get("funding_rate_annualized"),
                "open_interest_usd": item.get("open_interest_usd"),
                "volume_24h_usd": item.get("volume_24h_usd"),
                "note": "No CoinGecko 7d/30d data — use HyperLiquid data for this coin"
            })
    
    # Limit to top 20 HL-only coins by volume
    compressed["hl_additional_coins"] = sorted(
        compressed["hl_additional_coins"],
        key=lambda x: x.get("volume_24h_usd") or 0, reverse=True
    )[:20]
    
    print(f"[CRYPTO_COMPRESS] CoinGecko coins: {len(compressed['top_coins'])}, HL-only coins: {len(compressed['hl_additional_coins'])}")
```

Update the Claude crypto prompt:
DATA SOURCE PRIORITY:

For coins in top_coins (CoinGecko top 50): use change_7d, change_30d from CoinGecko + funding_rate from HyperLiquid
For coins in hl_additional_coins (smaller coins on HyperLiquid): these ONLY have 24h change, funding rate, and OI from HyperLiquid. Do NOT show 7d as "N/A" — instead show the 24h change and note "7d: HL only". Use their funding data for squeeze/momentum analysis.
When recommending momentum picks, you can include coins from EITHER source. If a coin is a squeeze candidate with extreme funding divergence, it's high-signal regardless of whether CoinGecko has 7d data.
For momentum picks from hl_additional_coins, populate price as the mark price from HyperLiquid if available, and funding_rate from the HL data.


### FIX 3: Add X/Twitter Sentiment section powered by Grok

The crypto scanner already calls `self.xai.get_trending_tickers("crypto")` and the result is in `data["x_twitter_crypto"]`. But the compression currently only passes it through as `compressed["x_sentiment"]` generically, and Claude doesn't have a dedicated section for it.

**Step A: Improve the Grok prompt for crypto-specific X sentiment**

In `xai_sentiment_provider.py`, find `get_trending_tickers()`. When `asset_type == "crypto"`, the prompt is generic. Replace the crypto-specific prompt to focus on social velocity and sentiment momentum:

After line 114 (`if asset_type == "crypto":`), update the crypto block:
```python
        if asset_type == "crypto":
            asset_context = "cryptocurrencies, tokens, and DeFi projects"
            examples = "$BTC, $ETH, $SOL, altcoins, meme coins, DeFi tokens"
            
            # Override with crypto-specific high-signal prompt
            prompt = f"""Search X for the most actively discussed cryptocurrencies and tokens right now (last 12-24 hours).

PRIORITY SIGNALS I NEED:
1. SOCIAL VELOCITY: Which crypto tokens have seen the SHARPEST INCREASE in X mentions in the last 24 hours? Not just high volume — I want ACCELERATION. A coin going from 100 mentions to 1000 mentions is more interesting than one with steady 5000 mentions.
2. SENTIMENT MOMENTUM: Which tokens are flipping from negative/neutral to POSITIVE sentiment? This shift matters more than absolute sentiment.
3. BTC SENTIMENT: Always include Bitcoin — what is the overall X sentiment on BTC right now? Is CT (crypto twitter) bullish, bearish, or indifferent? Any notable BTC narratives?
4. ALTCOIN HYPE: Which specific altcoins are getting disproportionate attention? Include ALL cap sizes — micro-caps getting sudden buzz are HIGHER signal than established large caps getting normal attention.
5. NARRATIVE PLAYS: What crypto narratives are heating up on X? (e.g., AI tokens, gaming, RWA, meme coins, L2s, DePIN, etc.)

DO NOT limit to large caps. A $50M token with exploding social interest is MORE valuable signal than ETH getting normal discussion.

Return ONLY a JSON object (no markdown, no backticks):
{{
    "scan_type": "x_crypto_sentiment",
    "timestamp": "now",
    "btc_sentiment": {{
        "overall": "bullish" | "bearish" | "neutral" | "mixed",
        "score": -1.0 to 1.0,
        "key_narrative": "What CT is saying about BTC right now",
        "notable_calls": ["Any notable trader/influencer BTC calls"]
    }},
    "market_mood": "risk-on" | "risk-off" | "mixed" | "euphoric" | "fearful",
    "trending_tickers": [
        {{
            "ticker": "SYMBOL",
            "mention_intensity": "extreme" | "high" | "medium",
            "social_velocity": "exploding" | "surging" | "rising" | "steady",
            "sentiment": "bullish" | "bearish" | "mixed",
            "sentiment_score": -1.0 to 1.0,
            "why_trending": "2-3 sentence explanation — what sparked the social buzz",
            "key_narratives": ["narrative1", "narrative2"],
            "catalyst": "Specific event driving discussion",
            "risk_flag": "Pump signals, bot activity, etc. or null",
            "estimated_market_cap_tier": "large" | "mid" | "small" | "micro" | "unknown",
            "trade_sentiment": "strong_buy" | "buy" | "hold" | "sell" | "speculative"
        }}
    ],
    "narrative_heat": [
        {{"narrative": "name", "buzz_level": "hot/warm/cold", "direction": "bullish/bearish", "top_tokens": ["SYM1", "SYM2"]}}
    ],
    "contrarian_signals": ["Any cases where X sentiment diverges from price action"],
    "summary": "3-4 sentence overview of crypto X sentiment right now"
}}

Return 10-15 tickers sorted by social velocity (fastest-growing mentions first).
Flag coordinated pump signals. Include genuine micro-cap momentum if the catalyst is real.
Always include BTC in trending_tickers even if its velocity is lower."""

            return await self._call_grok_with_x_search(prompt)
```

**Step B: Compress X sentiment data properly**

In the crypto compressor, make sure X sentiment data is preserved with its structure:
```python
    # X/Twitter Sentiment (Grok)
    x_data = data.get("x_twitter_crypto", {})
    if isinstance(x_data, dict) and not x_data.get("error"):
        compressed["x_sentiment"] = {
            "btc_sentiment": x_data.get("btc_sentiment", {}),
            "market_mood": x_data.get("market_mood"),
            "trending_tickers": (x_data.get("trending_tickers") or [])[:10],
            "narrative_heat": (x_data.get("narrative_heat") or [])[:5],
            "contrarian_signals": (x_data.get("contrarian_signals") or [])[:3],
            "summary": x_data.get("summary"),
        }
        print(f"[CRYPTO_COMPRESS] X sentiment: {len(compressed['x_sentiment'].get('trending_tickers', []))} trending tickers")
    else:
        compressed["x_sentiment"] = {}
        print(f"[CRYPTO_COMPRESS] X sentiment: unavailable or error")
```

**Step C: Add X sentiment section to Claude's crypto response schema**

In `prompts.py`, add to the crypto display_type schema:
```json
"x_sentiment": {
    "source": "X/Twitter via Grok",
    "btc_sentiment": {"overall": "", "score": 0, "key_narrative": ""},
    "market_mood": "",
    "top_social_movers": [{"symbol": "", "social_velocity": "", "sentiment": "", "why_trending": "", "catalyst": ""}],
    "narrative_heat": [{"narrative": "", "buzz_level": "", "direction": "", "top_tokens": []}],
    "contrarian_signals": [""],
    "summary": ""
}
```

**Step D: Update Claude's crypto preamble to include X sentiment section**

Add to the crypto instructions:
X/TWITTER SENTIMENT (from Grok scanning X in real-time):
You MUST include an "x_sentiment" section in your response using the x_sentiment data.

btc_sentiment: What is Crypto Twitter saying about BTC right now?
top_social_movers: Coins with the HIGHEST social velocity (fastest growing mentions). These are potential momentum plays.
narrative_heat: Which crypto narratives are trending on X
contrarian_signals: Where X sentiment diverges from price (high signal)
summary: Overall crypto X sentiment in 2-3 sentences

This section should appear AFTER the perps section and BEFORE momentum picks.
If x_sentiment data is empty or unavailable, skip this section entirely — do NOT fabricate X data.

### Testing
1. Click "Crypto" → "Top Perps by Volume" shows 5 coins with OI values (not "-")
2. Momentum picks for OM and AXS show funding rate data (not "-")
3. If OM/AXS don't have 7d data, they show source info instead of "N/A"
4. New "X Sentiment" section appears with BTC sentiment, trending tokens, narrative heat
5. X sentiment includes small/micro cap tokens if they have real momentum
6. Check logs: `[CRYPTO_COMPRESS] X sentiment: 10+ trending tickers`
7. Check logs: `[CRYPTO_COMPRESS] HL-only coins: 15+`
8. All other presets still work
9. `python -m pytest` passes